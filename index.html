<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>VMail Galáctico</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: radial-gradient(ellipse at center, #0a0f28 0%, #000000 100%);
      background-size: 400% 400%;
      animation: galaxyFloat 40s linear infinite;
      color: #e0ffe0;
    }
    @keyframes galaxyFloat {
      0% {background-position: 0% 0%;}
      100% {background-position: 100% 100%;}
    }
    .pulse-green { animation: pulseGreen 1s ease-out; }
    @keyframes pulseGreen {
      0% {box-shadow: 0 0 10px #00ff55;}
      100% {box-shadow: 0 0 0 transparent;}
    }
    .float-button {
      position: fixed; bottom: 30px; right: 30px;
      width: 60px; height: 60px; font-size: 24px;
      background-color: #00ff55; color: black;
      border: none; border-radius: 50%; cursor: pointer;
    }
    .message {
      padding: 10px; margin-bottom: 10px;
      background: rgba(255,255,255,0.05);
      border-left: 4px solid #00ff55;
    }
    input, button {
      margin: 5px; padding: 8px;
      border: none; border-radius: 4px;
    }
    #search { width: 200px; }
    #login-panel, #inbox-panel, #composer-panel {
      padding: 20px;
    }
  </style>
</head>
<body>
  <div id="login-panel">
    <h2>VMail Galáctico</h2>
    <input type="text" id="username" placeholder="Tu nombre" />
    <br/>
    <button onclick="register()">Registrar</button>
    <button onclick="login()">Entrar</button>
  </div>

  <div id="inbox-panel" style="display:none;">
    <h2 id="welcome-msg"></h2>
    <input type="text" id="search" placeholder="Buscar usuario..." />
    <p id="new-msg-alert">Tienes 0 mensajes nuevos</p>
    <div id="message-container"></div>
    <button onclick="logout()">Cerrar sesión</button>
    <button id="compose-btn" class="float-button" onclick="showComposer()">+</button>
  </div>

  <div id="composer-panel" style="display:none;">
    <h3>Redactar mensaje</h3>
    <input type="text" id="recipient" placeholder="Para..." />
    <textarea id="msg-text" placeholder="Tu mensaje..."></textarea><br/>
    <button onclick="sendMessage()">Enviar</button>
    <button onclick="hideComposer()">Cancelar</button>
  </div>

  <audio id="ping-sound" src="data:audio/wav;base64,UklGRhYAAABXQVZFZm10IBAAAAABAAEAgD4AAAB9AAACABAAZGF0YQAAAAA="></audio>

  <script>
    let messages = [];
    let username = '';

    function register() {
      const name = document.getElementById('username').value.trim();
      if (name) {
        localStorage.setItem('vmail-user-' + name, JSON.stringify({ registered: true }));
        alert('Usuario "' + name + '" registrado correctamente.');
      } else {
        alert('Por favor, introduce tu nombre antes de registrar.');
      }
    }

    function login() {
      username = document.getElementById('username').value.trim();
      if (!username) {
        alert('Introduce tu nombre para entrar.');
        return;
      }
      const userData = localStorage.getItem('vmail-user-' + username);
      if (userData) {
        document.getElementById('login-panel').style.display = 'none';
        document.getElementById('inbox-panel').style.display = 'block';
        document.getElementById('welcome-msg').innerText = `Bienvenido, Operador ${username}`;
        loadMessages();
      } else {
        alert('Usuario no registrado. Haz clic en "Registrar" primero.');
      }
    }

    function logout() {
      username = '';
      document.getElementById('inbox-panel').style.display = 'none';
      document.getElementById('login-panel').style.display = 'block';
    }

    function showComposer() {
      document.getElementById('composer-panel').style.display = 'block';
    }

    function hideComposer() {
      document.getElementById('composer-panel').style.display = 'none';
    }

    function sendMessage() {
      const recipient = document.getElementById('recipient').value.trim();
      const text = document.getElementById('msg-text').value.trim();
      if (recipient && text) {
        const newMsg = { to: recipient, from: username, text, read: false };
        messages.push(newMsg);
        localStorage.setItem('vmail-msgs', JSON.stringify(messages));
        hideComposer();
      }
    }

    function loadMessages() {
      const raw = localStorage.getItem('vmail-msgs');
      messages = raw ? JSON.parse(raw) : [];
      checkNewMessages();
    }

    function checkNewMessages() {
      const inboxMsgs = messages.filter(m => m.to === username);
      const newMsgs = inboxMsgs.filter(m => !m.read);
      document.getElementById('new-msg-alert').innerText = `Tienes ${newMsgs.length} mensajes nuevos`;
      renderInbox(inboxMsgs);
      if (newMsgs.length > 0) {
        pulseEffect();
        newMsgs.forEach(msg => msg.read = true);
        localStorage.setItem('vmail-msgs', JSON.stringify(messages));
      }
    }

    function renderInbox(msgs) {
      const container = document.getElementById('message-container');
      container.innerHTML = '';
      msgs.forEach(m => {
        const div = document.createElement('div');
        div.className = 'message';
        div.innerText = `De ${m.from}: ${m.text}`;
        container.appendChild(div);
      });
    }

    function pulseEffect() {
      const panel = document.getElementById('inbox-panel');
      panel.classList.add('pulse-green');
      setTimeout(() => panel.classList.remove('pulse-green'), 1000);
      document.getElementById('ping-sound').play();
    }

    setInterval(() => { if (username) loadMessages(); }, 3000);
  </script>
</body>
</html>